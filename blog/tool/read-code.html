<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>二维码扫描仪文件汇编程序</title>
<style>
#fileContainer {
  display: none;
}
#assembledFile {
  width: 80%;
  height: 200px;
}
</style>
</head>
<body>

<h1>二维码扫描仪文件汇编程序</h1>
<p>扫描由<a href="./make-code.html">这个软件</a>生成的二维码</p>
<div id="fileContainer">
  <label for="assembledFile">Assembled File:</label><br>
  <textarea id="assembledFile" rows="10" readonly></textarea><br>
</div>

<div id="qrScanner">
  <label>扫描二维码：</label><br>
  <div id="cameraPreview"></div><br>
  <button type="button" onclick="startScan()">开始扫描</button>
  <button type="button" onclick="stopScan()">停止扫描</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/quagga"></script>
<script>
var assembledData = '';
var scanning = false;

function startScan() {
  Quagga.init({
    inputStream : {
      name : "Live",
      type : "LiveStream",
      target: document.querySelector('#cameraPreview')
    },
    decoder : {
      readers : ["code_128_reader", "ean_reader", "ean_8_reader", "code_39_reader", "code_39_vin_reader", "codabar_reader", "upc_reader", "upc_e_reader", "i2of5_reader"]
    }
  }, function(err) {
    if (err) {
      console.error(err);
      return;
    }
    Quagga.start();
    scanning = true;
    console.log("Scanning started");
    Quagga.onDetected(handleCode);
  });
}

function stopScan() {
  Quagga.stop();
  scanning = false;
  console.log("Scanning stopped");
}

function handleCode(result) {
  if (scanning) {
    var qrCodeString = result.codeResult.code;
    assembledData += qrCodeString + '\n';

    var assembledFileTextarea = document.getElementById('assembledFile');
    assembledFileTextarea.value = assembledData;
  }
}
</script>

</body>
</html>
